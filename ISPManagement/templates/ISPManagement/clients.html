{% extends "blueprint/main.html"%}
{% load static %}

{% block extra_css %}
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
<link rel="icon" href="{% static 'ISPManagement/images/favicon.ico' %}" type="image/x-icon">
<link rel="stylesheet" href="{% static 'ISPManagement/dashboard.css' %}">
{% endblock %}
{% block title %}Dashboard{% endblock %}
{% block content %}
<div class="topnav" id>
  <a class="btn btn-primary" data-bs-toggle="offcanvas" href="#offcanvasExample" role="button" aria-controls="offcanvasExample">
     <i class="fa fa-bars"></i>
  </a>
  <div class="offcanvas offcanvas-start" tabindex="-1" id="offcanvasExample" aria-labelledby="offcanvasRightLabel">
    <a class="nav-link" href="#">Home</a>
    <div class="mt-3">
  <select class="form-select w-auto" onchange="handleClientSelect(this)">
    <option selected disabled>My clients</option>
    <option value="add">Add New Client</option>
    <option value="hotspot">Hotspot Clients</option>
    <option value="static">Static Clients</option>
    <option value="pppoe">PPPoE Clients</option>
  </select>
</div>

{% comment %} <script>
  function handleClientSelect(select) {
    const value = select.value;

    if (value === "add") {
      showForm("static"); // same function you were calling before
    } else if (value === "hotspot") {
      // redirect or load hotspot clients
      alert("Hotspot clients selected");
    } else if (value === "static") {
      alert("Static clients selected");
    } else if (value === "pppoe") {
      alert("PPPoE clients selected");
    }
  }
</script> {% endcomment %}

    <div id="formOverlay" class="overlay-form d-none">
      <form id="staticForm" method="post" class="form-box d-none">
        <center><legend>Add New Client</legend></center>
        <span class="close-pppoe-form" style="position: fixed; font-size: 1.5rem; cursor: pointer;">&times;</span>
        <div class="form-type-select mb-3">
        <label>
          <input type="radio" name="connection_type" value="static" id="radioStatic">
          Static
        </label>
        <label>
          <input type="radio" name="connection_type" value="pppoe" id="radioPppoe">
          PPOE
        </label>
      </div>
        {% csrf_token %}
        {{ static_form.as_p }}
        <button type="submit" class="btn btn-primary w-100">Register</button>
      </form>
      <form id="pppoeForm" method="post" class="form-box d-none">
        <center><legend>Register PPPOE Clients</legend></center>
        <span class="close-pppoe-form" style="position: fixed; font-size: 1.5rem; cursor: pointer;">&times;</span>
        {% csrf_token %}
        <input type="hidden" name="connection_type" value="pppoe">
        {{ pppoe_form.as_p }}
        <button type="submit" class="btn btn-primary w-100">Register</button>
      </form>
    </div>
    <a class="nav-link" href="{% url 'finance' %}">Finance</a>
    <a class="nav-link" href="{% url 'generating' %}">Generate Voucher</a>
    <select class="form-select w-auto" onchange="location = this.value;">
      <option selected disabled>Settings</option>
      <option value="{% url 'settings' %}">General Settings</option>
      <option value="{% url 'paymentsettings'%}">Payment Settings</option>
    </select>

  </div>
</div>
{% comment %} Div for summary of clients  {% endcomment %}
<div class="summary-cards">
  <div class="summary-card">
    <h5>PPOE Users</h5>
    <p>{{ pppoe_count }}</p>
  </div>
  <div class="summary-card">
    <h5>Static Users</h5>
    <p>{{ static_count }}</p>
  </div>
  <div class="summary-card">
    <h5>Hotspot Users</h5>
    <p>{{ hotspot_count }}</p>
  </div>
  <div class="summary-card">
    <h5>Total Users</h5>
    <p>{{ total_clients }}</p>
  </div>
</div>

{% comment %} Div for CPU/ Mikrotik Router Performance {% endcomment %}
<div class="summary-cards">
  <div class="summary-card">
    <h5>Router Identity</h5>
    <p>{{ router_info.identity }}</p>
  </div>
  <div class="summary-card">
    <h5>Uptime</h5>
    <p>{{ router_info.uptime }}</p>
  </div>
  <div class="summary-card">
    <h5>CPU Load</h5>
    <p>{{ router_info.cpu_load }}%</p>
  </div>
  <div class="summary-card">
    <h5>Memory</h5>
    <p>{{ router_info.free_memory }} Mb</p>
  </div>
</div>

{% comment %} Div for recent transactions {% endcomment %}
<div>
  <h4>Recent Transactions</h4>

  <table class="table table-striped">
    <thead>
      <tr>
        <th scope="col">ID</th>
        <th scope="col">User</th>
        <th scope="col">Transaction Code</th>
        <th scope="col">Amount</th>
        <th scope="col">Plan</th>
        <th scope="col">Date</th>
      </tr>
    </thead>
    <tbody>
      {% for transaction in transactions_data %}
      <tr>
        <th scope="row">{{ forloop.counter }}</th>
        <td>{{ transaction.user.username }}</td>
        <td>{{ transaction.mpesa_code }}</td>
        <td>{{ transaction.amount }}</td>
        <td>{{ transaction.plan }}</td>
        <td>{{ transaction.date|date:"Y-m-d H:i" }}</td>
      </tr>
      {% empty %}
      <tr>
        <td colspan="5">No transactions found.</td>
      </tr>
      {% endfor %}
    </tbody>
  </table>
</div>
{% comment %} Div for income today, total Income this week and Income this month {% endcomment %}
<div class="summary-cards">
  <div class="summary-card">
    <h4>Income Today</h4>
    <p>0</p>
  </div>

  <div class="summary-card">
    <h4>Income this month</h4>
    <p>0</p>
  </div>
</div>


{% block extra_js %}
<script>
  function showForm(type) {
    const overlay = document.getElementById('formOverlay');
    const staticForm = document.getElementById('staticForm');
    const pppoeForm = document.getElementById('pppoeForm');
    overlay.classList.remove('d-none');
    staticForm.classList.add('d-none');
    pppoeForm.classList.add('d-none');
    if (type === 'static') {
      document.getElementById('radioStatic').checked = true;
      staticForm.classList.remove('d-none');
    } else if (type === 'pppoe') {
      document.getElementById('radioPppoe').checked = true;
      pppoeForm.classList.remove('d-none');
    }
  }

  // Listen for radio button changes
  document.addEventListener('DOMContentLoaded', function() {
    const radioStatic = document.getElementById('radioStatic');
    const radioPppoe = document.getElementById('radioPppoe');
    const staticForm = document.getElementById('staticForm');
    const pppoeForm = document.getElementById('pppoeForm');
    radioStatic.addEventListener('change', function() {
      if (this.checked) {
        staticForm.classList.remove('d-none');
        pppoeForm.classList.add('d-none');
      }
    });
    radioPppoe.addEventListener('change', function() {
      if (this.checked) {
        pppoeForm.classList.remove('d-none');
        staticForm.classList.add('d-none');
      }
    });
  });

  // Hide form overlay after submission
  document.querySelectorAll("#formOverlay form").forEach(form => {
    form.addEventListener("submit", function () {
      setTimeout(() => {
        document.getElementById("formOverlay").classList.add("d-none");
        form.classList.add("d-none");
      }, 300); // adjust delay if needed
    });
  });

  function myFunction() {
    var x = document.getElementById("myLinks");
    if (x.style.display === "block") {
      x.style.display = "none";
    } else {
      x.style.display = "block";
    }
  }
  document.addEventListener('DOMContentLoaded', function() {
  const closePppoeBtn = document.querySelector('.close-pppoe-form');
  if (closePppoeBtn) {
    closePppoeBtn.addEventListener('click', function() {
      document.getElementById('formOverlay').classList.add('d-none');
      document.getElementById('pppoeForm').classList.add('d-none');
      // Optionally uncheck the radio
      document.getElementById('radioPppoe').checked = false;
    });
  }
});
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js" integrity="sha384-MrcW6ZMFYlzcLA8Nl+NtUVF0sA7MsXsP1UyJoMp4YLEuNSfAP+JcXn/tWtIaxVXM" crossorigin="anonymous"></script>
{% endblock %}
{% endblock %}